<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Screener Autobot Planner</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="p-6">

    <div id="app" class="max-w-7xl mx-auto">
        <h1 class="text-2xl font-bold mb-6">Swing Autobot Trade Planner</h1>

        <input type="file" @change="loadCSV" accept=".csv" class="mb-6">

        <div v-if="plans.length">
            <table class="min-w-full rounded-lg overflow-hidden text-sm border border-gray-400">
                <thead>
                    <tr>
                        <th class="p-2 text-left border-b cursor-pointer" @click="sortBy('symbol')">
                            Symbol <span v-if="sortKey === 'symbol'">{{ sortDir === 'asc' ? '▲' : '▼' }}</span>
                        </th>
                        <th class="p-2 text-right border-b cursor-pointer" @click="sortBy('score')">
                            Score <span v-if="sortKey === 'score'">{{ sortDir === 'asc' ? '▲' : '▼' }}</span>
                        </th>
                        <th class="p-2 text-right border-b cursor-pointer" @click="sortBy('price')">
                            Price <span v-if="sortKey === 'price'">{{ sortDir === 'asc' ? '▲' : '▼' }}</span>
                        </th>
                        <th class="p-2 text-right border-b cursor-pointer" @click="sortBy('entry')">
                            Entry <span v-if="sortKey === 'entry'">{{ sortDir === 'asc' ? '▲' : '▼' }}</span>
                        </th>
                        <th class="p-2 text-right border-b cursor-pointer" @click="sortBy('stop')">
                            Stop <span v-if="sortKey === 'stop'">{{ sortDir === 'asc' ? '▲' : '▼' }}</span>
                        </th>
                        <th class="p-2 text-right border-b cursor-pointer" @click="sortBy('target')">
                            Target <span v-if="sortKey === 'target'">{{ sortDir === 'asc' ? '▲' : '▼' }}</span>
                        </th>
                        <th class="p-2 text-right border-b cursor-pointer" @click="sortBy('riskPercent')">
                            Risk % <span v-if="sortKey === 'riskPercent'">{{ sortDir === 'asc' ? '▲' : '▼' }}</span>
                        </th>
                        <th class="p-2 text-right border-b cursor-pointer" @click="sortBy('rewardPercent')">
                            Reward % <span v-if="sortKey === 'rewardPercent'">{{ sortDir === 'asc' ? '▲' : '▼' }}</span>
                        </th>
                        <th class="p-2 text-left border-b cursor-pointer" @click="sortBy('notes')">
                            Notes <span v-if="sortKey === 'notes'">{{ sortDir === 'asc' ? '▲' : '▼' }}</span>
                        </th>
                    </tr>
                </thead>
                <tbody>
                    <tr v-for="p in sortedPlans" :key="p.symbol">
                        <td class="p-2 border-b flex items-center">
                            <span
                                :style="{display: 'inline-block', width: '6px', height: '28px', 'border-radius': '3px', 'margin-right': '8px', background: getSetupColor(p.notes)}"></span>
                            {{ p.symbol }}
                        </td>
                        <td class="p-2 text-right border-b">{{ p.score.toFixed(2) }}</td>
                        <td class="p-2 text-right border-b">${{ p.price.toFixed(2) }}</td>
                        <td class="p-2 text-right border-b">${{ p.entry.toFixed(2) }}</td>
                        <td class="p-2 text-right border-b">${{ p.stop.toFixed(2) }}</td>
                        <td class="p-2 text-right border-b">${{ p.target.toFixed(2) }}</td>
                        <td class="p-2 text-right border-b">{{ p.riskPercent }}%</td>
                        <td class="p-2 text-right border-b">{{ p.rewardPercent }}%</td>
                        <td class="p-2 border-b">{{ p.notes }}</td>
                    </tr>
                </tbody>
            </table>

            <div class="mt-6 p-4 border rounded-lg text-sm">
                <h3 class="font-bold mb-3">Cómo se calculan los valores:</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <h4 class="font-semibold mb-2">Precios de Trade:</h4>
                        <ul class="space-y-1 text-xs">
                            <li><strong>Entry:</strong> Dinámico según RSI y VWAP:</li>
                            <li class="ml-3">- RSI &gt; 70 y precio &gt; VWAP: Pullback al VWAP + 0.2%</li>
                            <li class="ml-3">- RSI &lt; 30: Precio actual + 0.5% (momentum)</li>
                            <li class="ml-3">- RSI entre 30-70 y precio &gt; VWAP: VWAP + 0.2%</li>
                            <li class="ml-3">- RSI entre 30-70 y precio &lt; VWAP: Precio actual + 0.3% (potencial
                                reversión/breakout)</li>
                            <li><strong>Stop:</strong> VWAP - (VWAP × ATR% × 0.5)</li>
                            <li><strong>Target:</strong> Dinámico según ATR y RSI:</li>
                            <li class="ml-3">- ATR &gt; 5 y RSI &lt; 70: Entry + (Risk × 2.0)</li>
                            <li class="ml-3">- RSI &gt; 75 o ATR &lt; 2: Entry + (Risk × 1.0)</li>
                            <li class="ml-3">- Si no, Entry + (Risk × 1.5)</li>
                        </ul>
                    </div>
                    <div>
                        <h4 class="font-semibold mb-2">Risk &amp; Reward:</h4>
                        <ul class="space-y-1 text-xs">
                            <li><strong>Risk %:</strong> (Entry - Stop) / Entry × 100</li>
                            <li><strong>Reward %:</strong> (Target - Entry) / Entry × 100</li>
                            <li><strong>R/R Ratio:</strong> Reward% / Risk%</li>
                        </ul>
                    </div>
                    <div>
                        <h4 class="font-semibold mb-2">Score (0-10):</h4>
                        <ul class="space-y-1 text-xs">
                            <li>+ Volatilidad 30m (×2)</li>
                            <li>+ Performance 1W (×1.5)</li>
                            <li>- ATR% (×1.2)</li>
                            <li>+ EMA9 &gt; EMA21 (+2)</li>
                            <li>± Earnings proximity</li>
                            <li>± RSI levels</li>
                            <li>± VWAP deviation</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <div v-else class="mt-4">Sube un archivo CSV para generar los trades.</div>
    </div>

    <script src="app.js"></script>

</body>

</html>